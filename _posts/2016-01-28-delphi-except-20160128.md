---
layout: post
title: 好的异常处理策略
categories: delphi之异常处理 软件质量之稳定性
tags: delphi 异常处理
---

在之前的博客中详细的介绍了Delphi的异常处理得当代码逻辑、异常处理的各方面的知识，详见下面的链接

* [再看Delphi的异常处理](http://www.xumenger.com/delphi-except-20160116/)
* [Delphi异常处理时代码的执行逻辑](http://www.xumenger.com/delphi-exception-20151201/)
* [总结一下最近开发遇到的问题，以及最近需要学习的知识点](http://www.xumenger.com/learn-plan-20151123/)
* [Delphi中的异常处理](http://www.xumenger.com/delphi-exception-20150428/)
* [Delphi中的异常处理](http://www.xumenger.com/delphi-exception/)

但是一直有一个问题，就是等到自己真正在开发一个项目的时候，具体要怎么应用异常处理就没了策略，尤其是开发一个持续运行的软件项目，更需要进行充分的、合理的异常处理，以保证在遇到意外情况的时候任务（一般是持续运行的线程）不意外终止，能够合理的处理异常并且继续运行。经过长时间的开发实践，加上自己很笨的脑袋的思考，总结出一套简单的在开发中进程异常处理的原则，两者需要结合才能最大化的保证软件项目的质量

##笼统性的异常处理

一般的场景是这样的，线程要持续运行，其实线程方法都是一个循环，而且循环中可能有多重循环，循环1内部会有另一层循环2……

**好的规范是在每一层循环内都先包一个异常处理的逻辑**。

这就是是笼统的捕获和处理异常，因为只是简单的在一个循环中做一个异常处理，并不能精确是在循环的什么地方出现的异常。但是这样做已经是一个很好的软件质量的保证了，可以保证异常不导致线程循环的异常结束，保证线程不因为异常而被意外的结束

##精确的异常处理

怎么进行精确的异常处理，以Delphi开发为例，其实所有的语言都是一样的原则：在一些容易出现异常的代码逻辑出进行针对性的异常处理

下面列出一些常见的异常，但是只是一部分，还有很多容易出现异常的地方会在后续的开发中更多的遇到，也会持续的补充

* 比如打开DBF文件可能是一个容易出现异常的地方
  * 多说一句，为了保证少出现打开DBF出现异常的情况，最好是打开一次，持续使用，到最后不用时再关闭
  * 这样一方面可以减少频繁打开关闭可能导致出现打开DBF的异常，而可以避免反复打开关闭DBF的性能浪费
* 格式化如`Format('my name is %6s',['wind']);` 是可能因为类型不对应而出现异常的地方
* 连接数据库的地方容易出现异常
* 执行SQL或者调用存储过程的地方
* 网络连接、网络通信的代码逻辑处可能出现网络连接异常等异常
* 按照一定的格式规范解析数据包的时候也是可能出现异常的地方，比如正在解析的包格式是不对的，那么解析包可能就会抛出异常
* 还有比如`StrToInt`，如果执行`I := StrToInt('aa')`，则会抛出异常
  * 不过可以不使用`try..except`捕获异常的方式，而使用`I := StrToIntDef(字符串, 默认整数)`的方式，比如`I := StrToIntDef('aa', 1)`
  * `StrToFloat`也建议写成`StrToFloatDef`的方式
* 等等很多具体的可能出现异常的地方需要进行针对性的异常处理
