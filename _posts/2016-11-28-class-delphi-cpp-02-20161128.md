---
layout: post
title: Delphi对象内存模型：Delphi继承语法下的对象内存
categories: c/c++之指针与内存 delphi之指针与内存 delphi之面向对象 c/c++之面向对象 软件质量之内存管理 深入学习之内存管理
tags: delphi 面向对象 多态 Delphi对象内存模型 继承
---

多态的本质是“将派生类类型的指针赋值给基类类型的指针”。那么，为什么这种赋值是允许的，或者说是安全的呢？

从语义上讲，继承所表现的是“是一种”关系，也就是说，每个派生类对象必定“是一种”基类对象。所以任何向基类类型的请求，派生类对象都可以无条件地正常处理。因为麻雀“是一种”鸟，燕子“是一种”鸟，所以所有对于鸟的操作请求，它们都应该正常处理

从语言上来讲，由于派生类通常比基类拥有更多的数据成员而不是更少，派生类对象所占用的内存空间必定大于等于基类对象所占的内存空间。所以将基类类型的指针指向派生类类型的对象时，在指针的可视范围中的内存必定是可用的，这一部分内存空间必定是属于对象的。所以这种赋值行为是合法的、安全的

##Delphi的继承

首先定义一个基类TBase

```
TBase = class
private
	x: Integer;
	y: Integer;
end;
```

定义继承自Base的子类Derived

```
TDerived = class(TBase)
private
	z: Integer;
end;
```

可以将基类的指针指向其派生类的对象

```
var
	base: TBase;
	derived: TDerived;
begin
	derived := TDerived.Create();
	base := derived;

	//以上代码可以简化为 base := TDerived.Create();

	...
end;
```

TBase类型的指针（base指针）指向了derived对象实体所在的内存首地址。因为每个派生类对象实体中都包含一个完整的基类对象实体，此处的base指针可以访问的范围正是这个完整基类（TBase）对象实体的大小。因此，base指针始终可以合法地访问其所指向的内存空间

![image](../media/image/2016-11-28/06.png)

>以上内容主要参考自[《Delphi高手突破》](http://nicrosoft.net/category/book/)
