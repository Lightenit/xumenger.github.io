---
layout: post
title: 比较C++、Java、Delphi声明类对象时候的相关语法和原理
categories: c/c++之面向对象 delphi之面向对象 java之面向对象
tags: delphi c c++ java oop
---


C++中创建对象的两种语法
-------------

在c++的类中，我如果要访问类中的成员变量或函数，有2种方法，第一种就是定义一个一个对象，如：

    Class A ...
    A aa;
    aa.xxx();

另外一种就是

    Class B ...
    B *aa = new B();
    aa->xxx();

Java、C++、Delphi中创建对象
---------

在java中，`A a = new A();`等同于c++中的 `A a;`　　

另外在c++中还有另外一种声明和实例化就是使用指针，如：`A* a= new A();`，在Java中没有对应的形式，最重要的原因是C++中的这种声明形式的内存是需要程序员手动管理的，但是Java有内存回收机制，不需要程序员关心对象的内存的问题。

上面是从内存回收的角度看，这时候：在java中，`A a = new A();`等同于c++中的 `A a;`　

但是假如从创建对象的时间来看：在java中，`A a = new A();`也可以看成等同于c++中的 `A *a = New A();`

c++中的`A a`;就已经构造了对象。但是在java中 `A a`; 就只是声明，但是还没有分配空间，java中的`A a = new A()`才是分配了内存的。而C++中的`A *a;`也只是声明了一个指针，但是还没有分配指针，`a = new A();`才是创建了一个实体，并且另指针a指向这个实体的内存地址！

再说说Delphi，假如有一个类ClassA，然后声明一个对象，代码大概如下：

    var
        ObjectA: ClassA;    //这里只是声明了一个变量名，Delphi中变量名其实就是一个指针，此时并没有分配空间
    begin
        ObjectA:= ClassA.Create;     //这里才是创建了一个内存实体，分配了内存空间，并且令ObjectA指向这块内存地址
        //注意这里的语法格式不同于C++的ClassA *ObjectA = new ClassA(); 
        //也不同于Java的ClassA ObjectA = new ClassA();
        //注意区别三者的语法格式的不同
    end;
    
在Delphi的面向对象的语法中，要注意[理解Delphi对象名与对象实体的本质区别](http://xumenger.github.io/delphi-class-object/)，一个Delphi的对象的对象名其实本质上就是一个指针，指向内存中的对象实体。

C++的静态与动态内存分配
-------------

在C++中就非常的灵活，A a;是在栈(stack)上分配空间，是静态的。而A * a= new A;是在堆(heap)上分配空间，是动态的。栈上空间自动回收，堆空间需要程序员手动回收

静态分配内存适合于编译时就已经可以确定需要占用内存多少的情况，而在编译时不能确定内存需求量时可使用动态分配内存；但静态分配内存的运行效率要比动态分配内存的效率要高，因为动态内存分配与释放需要额外的开销；动态内存管理水平严重依赖于程序员的水平，如果处理不当容易造成内存泄漏。

动、静态内存分配比较可以知道动态内存分配相对于静态内存分配的特点：

> 1)不需要预先分配存储空间；  
> 2)分配的空间可以根据程序的需要扩大或缩小。

 
对于C++语言： 

    A a =new A();     //会报错
    A *a=new A();    //这样是对的

详细说明原因：

    //只能是
    A a;
    //或者是
    A *a = new A();
    //没有
    A a = new A();    //这个是Java中的语法，所以要区分C++和Java的语法和机制

如果用A* a = new A();声明了对象

    a.run();    //会报错
    a->run();    //这才是正确的语法

