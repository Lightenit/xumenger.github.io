---
layout: post
title: delphi怎么写代码实现生成dbf文件
categories: delphi之数据库 delphi之多线程 
tags: delphi dbf ado bde 多线程
---

这主要是自己在一次任务开发中，要求程序在运行的时候生成新的dbf文件来存储数据，所以在这方便就找到了一些使用的方法，也有一些注意事项

不过，做完这次开发也只是简单的知道怎么用一些API、遇到的一些问题要怎么解决，但是对于设计到的相关的数据库引擎、具体的深入的原因还是不够清楚的，这个也是接下来需要提升的地方

##使用BDE方式创建新的DBF

刚开始的时候，参考我们组内其他同事的程序，可以实现通过代码实现创建dbf文件，大概的代码是这样的

```
unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, DBTables, DB;

type
  TForm1 = class(TForm)
    btn1: TButton;
    procedure btn1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

  T2Array = array of array of string;

var
  Form1: TForm1;
  table: TTable;

implementation

{$R *.dfm}

procedure TForm1.btn1Click(Sender: TObject);
var
  i: Integer;
  ArrData: T2Array;
  field: TFieldDef;
begin
  table:= TTable.Create(nil);
  SetLength(ArrData,4,2);
  ArrData[0][0] := 'row1';
  ArrData[0][1] := '10';
  ArrData[1][0] := 'row2';
  ArrData[1][1] := '20';
  ArrData[2][0] := 'row3';
  ArrData[2][1] := '2';
  ArrData[3][0] := 'row4';
  ArrData[3][1] := '2';

  table.Close;
  table.Active:=false;
  table.Exclusive:=true;
  table.TableName:='.\test.DBF';
  table.TableType:=ttFOXPRO;

  table.FieldDefs.Clear;
  for i := Low(ArrData) to High(ArrData) do
  begin
    field:= table.FieldDefs.AddFieldDef;

   field.Name := ArrData[i][0];
   field.DataType := FTSTRING;
   field.Size := StrToInt(ArrData[i][1]);

  end;
  table.CreateTable;
end;

end.
```

这里只是一个简单的小demo创建dbf的例子，放到多线程环境下，在自己本地进行测试的时候（自己简单的封装了一个使用这种方式创建DBF文件的函数），每个线程（主线程和子线程）都可以正常创建DBF文件

但是等到将程序部署到客户实际的环境之后，出现问题了，在创建DBF文件的时候会报错：创建DBF失败：An error occered while initializing Borland Database Engine (error $2108)

经过上网查询，确定大概的问题是因为客户那里没有安装BDE（Borland Database Engine）数据库引擎。然后尝试在其中的一个客户那里安装了BDE数据库引擎，然后在运行这个多线程程序，创建DBF是OK的

##继续改进--拷贝DBF文件

在一个客户那里将问题解决了，但是不能要求所有的用户为了使用我的这个程序，都要现在立即在额外安装BDE数据库引擎

不过现场情况紧急，需要当天现场测试能通过，所以就需要想一个暂时的解决方法，于是就想到，我这边先将需要的DBF文件创建好，然后修改程序逻辑，将创建DBF的方法改成拷贝DBF文件，然后将需要的空的DBF文件的模板提供到现场，要求用户放到指定目录下

这样通过这种稍微复杂点的配置方法，避免每个客户再去安装BDE数据库引擎，然后将当天的现场测试通过了

##还是不好--还是得在程序中创建DBF

这样的方式
