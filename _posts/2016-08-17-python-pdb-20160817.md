---
layout: post
title: 使用pdb调试Python程序
categories: python之基础
tags: pdb python 调试
---

##说明

python自带pdb库，使用pdb调试python程序还是很方便的。但是远程调试、多线程，pdb是搞不定的

多说一句，Python的调试器是pdb，对应在Linux 下面C 的调试器是gdb

本文参考的相关文章如下：

* [《指针和字符串和字符串常量、用gdb来获取非法内存中的内容》](http://www.xumenger.com/pointer-string-const-gdb/)
* [《Linux gdb调试器用法全面解析》](http://www.xumenger.com/linux-gdb-debug/)
* [《用PDB库调试Python程序》](http://www.cnblogs.com/dkblog/archive/2010/12/07/1980682.html)

##用pdb调试有多种方式

使用pdb调试Python的程序的方式主要是下面的三种！下面逐一介绍

###命令行加-m参数

命令行启动目标程序，加上-m参数，这样调用testPdb.py的话断点就是程序执行的第一行之前

```
python -m pdb testPdb.py
```

###在python交互环境调试

```
>>> import pdb
>>> import testPdb
>>> pdb.run('testPdb.test()')
```

###代码中插入一段程序

比较常用的，就是在程序中间插入一段程序，相对于在一般IDE 里面打上断点然后启动debug，不过这种方式是hardcode的

```
if __name__ == "__main__":
  a = 1
  import pdb
  pdb.set_trace()
  b = 2
  c = a + b
  print(c)
```

然后正常运行脚本：`python testPdb.py`到了pdb.set_trace()那里就会定下来，然后就可以看到调试的提示符(Pdb)了

针对上面的这段小程序的调试情况如下：

![imge](../media/image/2016-08-17/01.png)

##常用的调试命令

接下来使用上面介绍的第一种方式来调试Python程序，以此来介绍pdb常用的命令，对应使用到的测试程序是这样的：

###testFun.py

```
#!/usr/bin/python
# -*- coding: utf-8 -*-

def add(a, b):
    return a + b
```

###testPdb.py

```
#!/usr/bin/python
# -*- coding: utf-8 -*-

def sub(a, b):
    return a - b

if __name__ == "__main__":
    
    print ''
    import testFun
    i = 0
    a = 1
    while(i < 100):
        a = testFun.add(a, 1)
        i = i + 1
    print "累加结果：", a
    print ""

    for letter in 'Pdb':
        print "当前字母：", letter
    print ""

    fruits = ['banana', 'apple', 'mango']
    for fruit in fruits:
        print "当前水果：", fruit
    print ""


    ret = 0
    for num in range(10, 12):
        ret = sub(ret, num)
    print '循环结果：', ret
    print ""

    d = {'abc': 123, 123: "abc"}
    for (k,v) in d.items():
        print "当前键值对：", k, '-', v
    print ""
```

##总结常用的命令

**h(elp)**

会打印当前版本Pdb可用的命令，如果要查询某个命令，可以输入`h [command]`，例如`h l`可以查看list命令

![imge](../media/image/2016-08-17/02.png)

**l(ist)**

可以列出当前将要运行的代码块

![imge](../media/image/2016-08-17/03.png)

**b(reak)**设置断点

* 比如`b 12`就是在当前脚本的第9行加上断点
* `b sub`就是在当前脚本的sub函数定义处加断点
* 除了可以在当前的脚本中添加断点之外，还可以在当前脚本对其他脚本下断点，以上面用到的代码为例`b testFun.add`就可以实现在testFun.py脚本中的add函数处加断点
* 如果只用`b`就会显示现有的全部断点

![imge](../media/image/2016-08-17/04.png)

**condition bpnumber [condition]**

设置条件断点，比如`condition 2 a==0`，就是在第二个断点出加条件“a==0”

![imge](../media/image/2016-08-17/05.png)

**cl(ear)

如果后面带有参数，就是清楚指定的断点；如果不带参数就是清除所有的断点

![imge](../media/image/2016-08-17/06.png)

**disable/enable**禁用/激活断点

![imge](../media/image/2016-08-17/07.png)

